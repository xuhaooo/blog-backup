## 刻舟求剑
> 楚国有人坐船渡河时，不慎把剑掉入河中，他在舟上刻下记号，说：“这是我把剑掉下的地方”当舟停驶时，船已经走了很远，剑是不会走动的。他沿着记号跳入河中找剑，遍寻不获

## 调用时机
JS 的函数所产生的结果，只能在调用的时候才能得出，并不是在定义的时候就能看出来的

## 举例说明
### 例1
```js
let a = 1
function fn(){
    console.log(a)
}
```
- 打印出什么？
- 答：不知道，因为函数根本没有调用

### 例 2
```js
let a = 1
function fn(){
    console.log(a)
}
fn()
```
- 打印出什么？
- 答：1

### 例 3
```js
let a = 1
function fn(){
    console.log(a)
}
a = 2
fn()
```
- 打印出多少？
- 答：2
- 解释：作为刚学习 JS 函数的小白，在最后一行函数调用之后，我们看到了第一行定义了 a 为 1，然后觉得第 3 行 `console.log(a)` 理所应当会打印出 1，这个时候我们就是那个在文章开头在船上刻记号的楚国人。事实上，在函数调用的时候，那只船已经开走了，a 已经被赋值为 2 了，所以打印出的自然是 2。即，我们只能在函数调用的时候才能得出函数的输出。

### 例 4
```js
let a = 1
function fn(){
    console.log(a)
}
fn()
a = 2
```
- 打印出多少？
- 答：1
- 解释：函数调用的时候，a 还没有被赋值为 2。

### 例 5
```js
let a = 1
function fn(){
    setTimeout(() = > {
        console.log(a)
    },0)
    // 打游戏时，说马上过来吃饭
    // JS 一样，它先要把代码执行完了，才会在等会要做的事情
}
fn()
a = 2
```
- 打印出多少？
- 答：2
- 解释：`setTimeout(fn, 0)` 的意思是，等一下执行 fn，这个“等一下”有一些抽象，我们可以用一个生活中的例子来帮助理解，想象这样的场景：你正在打游戏的通关 boss，这个时候你的朋友喊你出去逛街，你的回答说“等一下“我马上来，事实上，你并不是立刻停止游戏，而是会在把通关 boss 干掉之后才会和朋友逛街。同理，`setTimeout(fn, 0)` 并不会立刻执行，而是会在接下来的 JS 代码运行完，才会执行，即等到代码走完了全部 8 行之后，才会执行 fn，而这个时候 a 已经被赋值为 2 了，所以打印的结果为 2。


## 令人困惑的代码
```js
let i = 0 
for(i = 0; i < 6; i++){
    setTimeout(() => {
        console.log(i)
    },0)
}
```
- 打印出多少?
- 答：6 个 6
- 解释：打印的结果不是 0，1，2，3，4，5，这是为什么呢？首先，上面的的例 5 已经解释过 `setTimeout(fn, 0)` 的执行逻辑，在这段代码中也是一样，它会等 for 循环执行完才会执行，那结果为什么不是一个 6，而是 6 个 6 呢？可以这么理解，我们可以认为 `setTimeout(fn, 0)` 这是定了一个闹钟，然后等后面的代码执行了之后，它就开始响（执行），而 for 循环的逻辑是，每一个 i 符合循环条件，它都会执行一遍循环内部的代码，也就是说每一个 i 符合循环条件，它都会定一个闹钟，所以一共定了 6 个闹钟，每一个闹钟都是在”一会儿”之后响（执行），而这个”一会儿“就是在循环结束之后，循环结束之后 i 就是 6，这个时候这 6 个闹钟就开始”响“了，至此，打印 6 个 6。


## JS 的妥协
```js
for(let i = 0; i < 6; i++){
    setTimeout(()=>{
       console.log(i)
    },0)
}
```
- 打印出多少?
- 答：0、1、2、3、4、5
- 解释：可以看出这段代码跟上面那段的区别就是，let 拿到了里面来了，但是为什么结果会变呢？因为 JS 在 for 和 let 一起用的时候回会东西。或许是因为上面的代码总是让 JS 小白非常困惑想不明白，所以 JS 妥协了，既然总是有很多小白怎么想都想不通，那我将错就错，let 在 for 循环里面的时候，就每次循环设置 setTimeout 的时候都将当前的 i 复制一份保存在里面，满足笨蛋小白的想象，因此打印结果是这样。


## ES 6 之前的其他方法
### 利用 setTimeout 第三个参数
```js
for (var i=0; i<6; i++) {
	setTimeout(function(i){
		console.log(i)
	}, 0, i)
}
// 0,1,2,3,4,5
```
### 利用闭包
```js
for(var i=0; i<6; i++) {
	!(function(j) {
		setTimeout(function(){
			console.log(j)
		}, 0)
	})(i)
}
// 0,1,2,3,4,5
```
